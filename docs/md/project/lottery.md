# 总结

## 介绍一下这个项目
面试官您好，我这个项目名字叫营销云平台，抽奖系统和数据集成系统都是其中的两个模块，

第一个模块我参加了30%的工作量，主要是核心模块抽奖功能，搭建完成抽奖流程的编写，
以及校验引擎的搭建。

第二个模块是我主导负责的，以配置数据源、数据清洗、数据集成一整体业务逻辑将数据清洗成
完整干净的数据，供报表以及分析模块所使用。


## 介绍下做的模块
核心抽奖策略，是当用户领取完活动，进入抽奖流程时，首先获取抽奖策略，
校验抽奖策略是否已经初始化到内存、获取不在抽奖范围内的列表，
包括：奖品库存为空、风控策略、临时调整等，然后执行抽奖算法，返货包装中奖结果。
目前系统中有两种抽奖算法，一种是必中奖，另一种可能中奖。

总体概率：如果A奖品抽空后，B和C奖品的概率按照 3:5 均分，相当于B奖品中奖概率由 0.3 升为 0.375

单项概率：如果A奖品抽空后，B和C保持目前中奖概率，用户抽奖扔有20%中为A，因A库存抽空则结果展示为未中奖。为了运营成本，通常这种情况的使用的比较多。

在数据库设计是用到了两张表，策略配置表以及策略详情表，它们的关系是1vn。

策略配置表是记录了策略ID、描述信息、发奖时间、发奖方式（人工、延时、定时）等

策略详情表是记录了策略ID、奖品编号、奖品库存、中奖概率。

总体逻辑是首先讲库存为空或者不符合条件过滤的从奖品列表中去除，随机概率大于当前概率，即返回奖品信息

单项概率是 有一个前提，要实时计算奖品概率，所以初始化过程中，遍历抽奖奖品，定一个线性数组，通过斐波拉契算法计算出数组的下标，比如A奖品的概率为20%，乘以100，线性数组当前下标放入改奖品。抽奖时，同样的方法计算出下标直接获取值，时间复杂度从o(n)变为o(1).

